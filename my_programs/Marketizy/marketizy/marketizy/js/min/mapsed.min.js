!function(){"use strict";var e="mapsed",t=1;$.fn.mapsed=function(n){function a(e){var t=(e.parents(".mapsed-root"),e.parents(".mapsed-view")),n=D(t);pt.onSelect(U,n)&&y()}function o(e){var t=e.parents(".mapsed-root"),n=t.find(".mapsed-lat").val(),a=t.find(".mapsed-lng").val(),o=g(n,a);y(),o.showTooltip(!0)}function l(e){e.preventDefault();var t=Z.getCenter(),n=new dt.LatLngBounds,a=P("New place",t,!0,"new");E(a),V.push(a),n.extend(t),dt.event.addListener(a,"click",function(){var e=this;if(y(),pt.onAdd){{$(e.tooltip.content)}pt.onAdd(U,e)}else e.showTooltip(!0)}),dt.event.addListener(a,"dragend",function(e){var t=this;t.details.lat=e.latLng.lat(),t.details.lng=e.latLng.lng();var n=$(t.tooltip.content);n.find(".mapsed-lat").val(t.details.lat),n.find(".mapsed-lng").val(t.details.lng)}),dt.event.trigger(a,"click")}function s(e){var t=e.parents(".mapsed-root"),n=t.find(".mapsed-view"),a=D(n);if(pt.onDelete(U,a)){var o=g(a.lat,a.lng);o.setMap(null),o.tooltip=null}}function i(e){var t=e.parents(".mapsed-root"),n=t.find(".mapsed-edit"),a="",o=D(n);a=pt.onSave(U,o);var l=n.find(".mapsed-error");if(a&&a.length>0)return l.text(a),void 0;l.text("");var s=g(o.lat,o.lng);jQuery.extend(s.details,o),t.find(".mapsed-marker-type").val("custom"),t.find(".mapsed-user-data").val(o.userData),s.showTooltip(!1)}function d(){if(ot){var e=at,t=e.position().left;t+=e.width()/2,t-=ot.width()/2;var n=e.position().top;n+=2*e.height(),ot.css("z-index",999).css("position","absolute").css("top",n).css("right","1%").css("width","20%"),pt.showHelpOnLoad&&at.click&&at.trigger("click")}pt.findGeoOnLoad&&U.setMapCentreByGeo()}function r(e,t,n){et||0==Q&&L(),et=!1,"ZERO_RESULTS"==t&&U.showMsg("No results","Your search returned no results.");for(var a,o=new dt.LatLngBounds,l=0;a=e[l];l++)if(a.reference){var s=a.geometry.location,i=m(a,s,"google",o);_(i.details,a.formatted_address),o.extend(s),Z.fitBounds(o)}n&&(K[0].disabled=!n.hasNextPage,n.hasNextPage&&dt.event.addDomListenerOnce(K[0],"click",function(){event.preventDefault(),Q++,n.nextPage()}))}function p(e,t){if(e.details&&e.details.reference){var n={reference:e.details.reference};q.getDetails(n,function(n,a){e.details.isLoaded=!0,a==rt.PlacesServiceStatus.OK&&(x(e.details,n),t(e))})}}function u(){var e=Z.getBounds();e&&z.setBounds(e),nt=!0}function c(e,t,n,a,o){var l=null,s="",i="";e=e||"",t=t||"",l=Y.find(".mapsed-modal"),l.length>0&&l.remove(),i+="<div class='mapsed-modal-button-bar'>",a&&a.length>0&&(i+="<p class='prompt'>"+a+"</p>"),i+="<div class='mapsed-modal-buttons'>",n?(i+="<button class='ok'>OK</button>",i+="<button class='cancel'>Cancel</button>"):i+="<button class='close'>OK</button>",i+="</div>",i+="</div>",s="<div class='mapsed-modal'><h3>"+e+"</h3><div><div class='mapsed-modal-message'>"+t+"</div>"+i+"</div></div>",l=$(s).appendTo(Y),l.find("button").on("click",function(){var e=$(this);l.fadeOut(),e.hasClass("cancel")||o&&o(e)}).end().fadeIn()}function m(e,t,n,a){var o=P(e.name,t,!1,n);return jQuery.extend(o.details,e),E(o),V.push(o),a.extend(t),dt.event.addListener(o,"click",function(){var e=this;y(),e.showTooltip(!1)}),e.autoShow&&o.showTooltip(!1),nt=!0,o}function f(e,t){var n=e;return t||(t=30),e.length>t&&(n=e.substring(0,t-3)+"..."),n}function h(e,t,n){if(e=ut("{NAME}",t.name,e),e=ut("{SHORT_NAME}",f(t.name,25),e),e=ut("{STREET}",t.street,e),e=ut("{TOWN}",t.town,e),e=ut("{AREA}",t.area,e),e=ut("{POSTCODE}",t.postCode,e),e=ut("{TELNO}",t.telNo,e),e=ut("{WEBSITE}",t.website,e),e=ut("{GPLUS}",t.url,e),t.photo){var a=t.photo.getUrl({maxWidth:"70"});e=ut("{PHOTOURL}",a,e),e=ut("{IMG","<img",e)}n.html(e)}function v(e,t){t.find(".mapsed-name").parent().toggle(e.name&&e.name.length>0),t.find(".mapsed-street").toggle(e.street&&e.street.length>0),t.find(".mapsed-town").toggle(e.town&&e.town.length>0),t.find(".mapsed-area").toggle(e.area&&e.area.length>0),t.find(".mapsed-postCode").toggle(e.postCode&&e.postCode.length>0);var n=t.find(".mapsed-telNo"),a=t.find(".mapsed-website"),o=t.find(".mapsed-url");e.telNo&&e.telNo.length>0?n.show().css("display","block"):n.hide(),e.website&&e.website.length>0?a.show().css("display","block"):a.hide(),e.url&&e.url.length>0?o.show().css("display","block"):o.hide(),t.find(".mapsed-right").toggle(null!=e.photo);var l=U.getSettings();if(l.onSelect||l.onSave||l.onDelete){var s,i,d,r;r=e.canEdit,"google"==e.markerType&&(r=!1),s=null!=l.onSelect,i=null!=l.onSave&&r,d=null!=l.onDelete&&r&&"custom"==e.markerType,t.find(".mapsed-select-button").toggle(s),t.find(".mapsed-edit-button").toggle(i),t.find(".mapsed-delete-button").toggle(d)}else t.find(".mapsed-buttons").hide()}function g(e,t){for(var n=null,a=0;a<V.length;a++){var o=V[a];if(o.position.lat()==e&&o.position.lng()==t){n=o;break}}return n}function b(){var e="mapsed-search-box-"+J;if(j=$("#"+e),!(j.length>0)){var t=pt.searchOptions,n="<input type='text' id='"+e+"' class='mapsed-searchbox' autocomplete='off' ";n+="placeholder='",n+=t.enabled&&t.placeholder?t.placeholder:"Search ...",n+="' ",t.enabled&&t.initSearch&&t.initSearch.length>0&&(n+=" value='"+t.initSearch+"'"),n+=" />",j=$(n).appendTo(Y),z=new rt.SearchBox(j[0]),Z.controls[dt.ControlPosition.TOP_LEFT].push(j[0]),dt.event.addListener(z,"places_changed",function(){var e=j.val();G(e)}),dt.event.addListener(Z,"bounds_changed",u),F=S(W.Go,dt.ControlPosition.TOP_LEFT,"mapsed-search-button mapsed-control-button",function(e){e.preventDefault();var t=j.val();G(t)}),K=S(W.More,dt.ControlPosition.TOP_LEFT,"mapsed-more-button mapsed-control-button",null),K[0].disabled=!0}}function w(){st||(st=S(W.AddPlace,dt.ControlPosition.TOP_RIGHT,"mapsed-add-button mapsed-control-button",l))}function T(){if(!lt){var e=function(e){if(e.preventDefault(),X){var t=!0;pt.onClose&&(t=pt.onClose(U)),t&&X&&U.closeMap()}};lt=S(W.CloseMap,dt.ControlPosition.TOP_RIGHT,"mapsed-close-button mapsed-control-button",e),$("body").on("keyup",function(t){t.preventDefault(),27==t.which&&e(t)})}}function O(){if(!it){var e=function(){U.setMapCentreByGeo()};it=S(W.Geo,dt.ControlPosition.TOP_RIGHT,"mapsed-geo-button mapsed-control-button",e)}}function C(){if(!ot){at=S(W.Help,dt.ControlPosition.TOP_RIGHT,"mapsed-help-button mapsed-control-button",function(e){e.preventDefault(),ot.fadeToggle(),at.toggleClass("open")});var e=pt.getHelpWindow();ot=$(e).appendTo(Y).click(function(){$(this).fadeOut(),at.toggleClass("open")}),ot.fadeOut()}}function S(e,t,n,a){var o=null,l="",s="",i="";if(n&&n.length>0&&(s=" class='"+n+"' "),e&&e.length>0){var d=e.split("|");e=d[0],i=d.length>1?" title='"+d[1]+"'":""}var l="<button "+s+i+">"+e+"</button>";return o=U.addMapControl(l,t),a&&o.on("click",a),o}function L(){if(V&&V.length>0)for(var e=0;e<V.length;e++){var t=V[e];t.tooltip=null,t.setMap(null)}V=[]}function y(){if(V&&V.length>0)for(var e=0;e<V.length;e++){var t=V[e];t.tooltip&&t.tooltip.close()}}function P(e,t,n,a){var o=null;pt.getMarkerImage&&(o=pt.getMarkerImage(U,a,e));var l=new dt.Marker({map:Z,icon:o,title:e,animation:dt.Animation.DROP,position:t,markerType:a,draggable:n});return l.details={markerType:a,isLoaded:"google"!=a,lat:t.lat(),lng:t.lng(),userData:"",reference:"",name:"",street:"",town:"",area:"",postCode:"",telNo:"",website:"",url:"",canEdit:"new"==a||"custom"==a},l}function E(e){if(e.id){var t=$("#mapsed-"+e.id);return t}var n=V.length+1,a=e.details;e.id=n;var t=$("<div id='mapsed-"+n+"' class='mapsed-root'><input type='hidden' class='mapsed-lat' value='"+e.position.lat()+"' /><input type='hidden' class='mapsed-lng' value='"+e.position.lng()+"' /><input type='hidden' class='mapsed-can-edit' value='"+a.canEdit+"' /><input type='hidden' class='mapsed-reference' value='"+a.reference+"' /><input type='hidden' class='mapsed-user-data' value='"+a.userData+"' /><input type='hidden' class='mapsed-marker-type' value='"+e.markerType+"' />"+M()+N()+"</div>");return e.tooltip=new dt.InfoWindow,e.tooltip.setContent(t[0]),e.tooltip.marker=e,e.showTooltip=k,t}function k(e){{var t=this,n=t.tooltip,a=t.details,o=$(n.getContent()),l=o.find(".mapsed-view"),s=o.find(".mapsed-edit");U.getSettings()}if(!a.isLoaded)return p(t,function(){t.showTooltip(e)}),void 0;if(s.toggle(e),l.toggle(!e),I(a),e){var i=N();h(i,a,s)}else{var i=M();h(i,a,l),v(a,l)}n.close(),n.open(Z,t)}function M(){var e="<table class='mapsed-container mapsed-view'><tr><td colspan='2'><h1 class='mapsed-name' title='{NAME}'>{SHORT_NAME}</h1></td></tr><tr><td class='mapsed-left'><address><div class='mapsed-street'>{STREET}</div><div class='mapsed-town'>{TOWN}</div><div class='mapsed-area'>{AREA}</div><div class='mapsed-postCode'>{POSTCODE}</div></address><a class='mapsed-telNo' href='tel:{TELNO}'>{TELNO}</a><a class='mapsed-website' href='{WEBSITE}' title='{WEBSITE}'>website</a><a class='mapsed-url' href='{GPLUS}' title='{GPLUS}'>g+</a></td><td class='mapsed-right'><a href='{GPLUS}'>{IMG src='{PHOTOURL}' /></a></td></tr><tr class='mapsed-buttons'><td colspan='2'><button class='mapsed-select-button'>Select</button><button class='mapsed-edit-button'>Edit</button><button class='mapsed-delete-button'>Delete</button></td></tr></table>";return e}function N(){var e="<div class='mapsed-container mapsed-address-entry mapsed-edit'><h1>Place details:</h1><ul><li><label>Name<input class='mapsed-name' type='text' placeholder='e.g. Bob sandwich shop' value='{NAME}' /></label></li><li><label>Street<input class='mapsed-street' type='text' placeholder='e.g. 3 Hemington place' value='{STREET}' /></label></li><li><label>Town<input class='mapsed-town' type='text' placeholder='e.g. Leeds' value='{TOWN}' /></label></li><li><label>Area<input class='mapsed-area' type='text' placeholder='e.g. West Yorkshire' value='{AREA}' /></label></li><li><label>Postcode<input class='mapsed-postCode' type='text' value='{POSTCODE}' /></label></li><li><label>Tel No<input class='mapsed-telNo' type='telephone' placeholder='contact telephone number' value='{TELNO}' /></label></li><li><label>website<input class='mapsed-website' type='url' placeholder='e.g. https://toepoke.co.uk' value='{WEBSITE}' /></label></li><li><label>g+ url<input class='mapsed-url' type='url' placeholder='e.g. https://plus.google.com/+ToepokeCoUk‎' value='{GPLUS}' /></label></li></ul><div class='mapsed-buttons'><button class='mapsed-save-button'>Save</button><span class='mapsed-error'>&nbsp;</span></div></div>";return e}function D(e){var t=e.parents(".mapsed-root"),n={canEdit:"true"===t.find(".mapsed-can-edit").val(),lat:t.find(".mapsed-lat").val(),lng:t.find(".mapsed-lng").val(),reference:t.find(".mapsed-reference").val(),markerType:t.find(".mapsed-marker-type").val(),userData:t.find(".mapsed-user-data").val()};return e.hasClass("mapsed-view")?(n.name=e.find(".mapsed-name").attr("title"),n.street=e.find(".mapsed-street").html(),n.town=e.find(".mapsed-town").html(),n.area=e.find(".mapsed-area").html(),n.postCode=e.find(".mapsed-postCode").html(),n.telNo=e.find(".mapsed-telNo").html(),n.website=e.find(".mapsed-website").attr("href"),n.url=e.find(".mapsed-url").attr("href")):(n.name=e.find(".mapsed-name").val(),n.street=e.find(".mapsed-street").val(),n.town=e.find(".mapsed-town").val(),n.area=e.find(".mapsed-area").val(),n.postCode=e.find(".mapsed-postCode").val(),n.telNo=e.find(".mapsed-telNo").val(),n.website=e.find(".mapsed-website").val(),n.url=e.find(".mapsed-url").val()),I(n),n}function I(e){e.canEdit||(e.canEdit=!1),e.lat||(e.lat=0),e.lng||(e.lng=0),e.userData||(e.userData=""),e.name||(e.name=""),e.street||(e.street=""),e.town||(e.town=""),e.area||(e.area=""),e.postCode||(e.postCode=""),e.telNo||(e.telNo=""),e.website||(e.website=""),e.url||(e.url="")}function A(){var e=new dt.LatLngBounds;L();var t=[];$.isArray(pt.showOnLoad)?t=pt.showOnLoad:t.push(pt.showOnLoad);for(var n=0;n<t.length;n++){var a=t[n],o=new dt.LatLng(a.lat,a.lng),l="";l=a.reference&&a.reference.length>0?"google":"custom",m(a,o,l,e)}Z.fitBounds(e),1==t.length&&Z.setCenter(o)}function G(e){var t=Z.getBounds();Q=0,L();var n={query:e,bounds:t};q.textSearch(n,r),j.val(e)}function x(e,t){var n=t.address_components,a=R(n,"street_address");""===a&&(a=R(n,"route"));var o=R(n,"locality"),l=R(n,"administrative_area_level_1"),s=R(n,"postal_code");e.street=a,e.town=o,e.area=l,e.postCode=s,e.name=t.name||"",t.photos&&t.photos.length>0&&(e.photo=t.photos[0]),e.url=t.url||"",e.website=t.website||"",e.telNo=t.formatted_phone_number||t.telNo||""}function _(e,t){if(t){var n=t.split(",");n.length>=1&&(e.street=$.trim(n[0])),n.length>=2&&(e.town=$.trim(n[1])),n.length>=3&&(e.area=$.trim(n[2])),n.length>=4&&(e.postCode=$.trim(n[3]))}}function R(e,t,n){if(null==e||0==e.length)return"";for(var a="",o=0;o<e.length;o++){for(var l=e[o],s=!1,i=0;i<l.types.length;i++){var d=l.types[i];if(d.toLowerCase()==t.toLowerCase()){s=!0;break}}if(s){a=n?l.short_name:l.long_name;break}}return a}var B=new google.maps.LatLng(53.798823,-1.5426760000000286),H=10,W={Go:"Go",More:"More|There are more results available ...",AddPlace:"+|Add a place",CloseMap:"&times;|Close map",Geo:"&otimes;|Centre map based on your location",Help:"?|Show help"},U=this,j=null,z=null,F=null,K=null,Q=0,Z=null,Y=null,q=null,V=[],J=-1,X=!1,et=!0,tt=!1,nt=!1,at=null,ot=null,lt=null,st=null,it=null,dt=null,rt=null,pt=$.extend({showOnLoad:null,mapOptions:{zoom:H,center:B,mapTypeId:google.maps.MapTypeId.ROADMAP},disablePoi:!1,allowAdd:!1,searchOptions:{enabled:!1,placeholder:"e.g. Hotels in Leeds",initSearch:"Hotels in Leeds",geoSearch:"5aside football near {POSITION}"},onSelect:null,onSave:null,onDelete:null,confirmDelete:!1,onClose:null,getMarkerImage:null,getHelpWindow:null,showHelpOnLoad:!1,allowGeo:!1,findGeoOnLoad:!1},n||{});this.getSettings=function(){return pt},this.getGoogleMap=function(){return Z},this.getMapContainer=function(){return Y},this.addMapControl=function(e,t){var n=null,a=null;return a=$(e),n=a.appendTo(Y),Z.controls[t].push(n[0]),n},this.disablePointsOfInterest=function(){Z.styles=[{featureType:"poi",stylers:[{visibility:"off"}]}]},this.closeMap=function(){Z=null,ot&&ot.fadeOut(),Y.fadeOut(function(){$(this).remove()}),X=!1},this.showMsg=function(e,t,n){c(e,t,!1,"",n)},this.showAddDialog=function(e){e.showTooltip(!0)},this.confirmMsg=function(e,t,n,a){c(e,t,!0,n,a)},this.setMapCentreByGeo=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var t=new dt.LatLng(e.coords.latitude,e.coords.longitude);Z.setZoom(10),Z.setCenter(t),it.addClass("is-active");var n=pt.searchOptions;if(n&&n.geoSearch&&n.geoSearch.length>0){var a=t.toUrlValue(),o=n.geoSearch.replace("{POSITION}",a);G(o)}n&&pt.showOnLoad&&A()},function(e){U.showMsg("GEO Position",e.message)})};var ut=function(e,t,n){return void 0==t&&(t=""),n.replace(new RegExp(e,"g"),t)},ct=function(){var n=null;dt=google.maps,rt=google.maps.places,n=Y.attr("id"),Z=new dt.Map(document.getElementById(n),pt.mapOptions),pt.disablePoi&&U.disablePointsOfInterest(),q=new rt.PlacesService(Z),J=t++,pt.onSelect&&Y.on("click","button.mapsed-select-button",function(){var e=$(this);a(e)}),pt.onSave&&(Y.on("click","button.mapsed-save-button",function(){var e=$(this);i(e)}),Y.on("click","button.mapsed-edit-button",function(){var e=$(this);o(e)})),pt.onDelete&&Y.on("click","button.mapsed-delete-button",function(){var e=$(this);if(pt.confirmDelete){var t=e.parents(".mapsed-view"),n=D(t),a="<strong>"+n.name+"</strong> will be deleted.";U.confirmMsg("Confirm Delete",a,"Are you sure?",function(){s(e)})}else s(e)}),pt.allowGeo&&O(),pt.searchOptions.enabled&&b(),(X||pt.onClose)&&T(),null!=pt.showOnLoad&&A(),pt.getHelpWindow&&C(),pt.allowAdd&&w(),pt.onPreInit&&pt.onPreInit(U),dt.event.addListener(Z,"tilesloaded",function(){tt||(d(),tt=!0,pt.onInit&&pt.onInit(U))});var l=pt.searchOptions;l.enabled&&l.initSearch&&l.initSearch.length>0&&G(l.initSearch),nt||(Z.setZoom(pt.mapOptions.zoom),Z.setCenter(pt.mapOptions.center));var r="plugin_"+e;Y.data(r)||Y.data(r,U)};if(this.each(function(){Y=$(this),ct()}),!this.length){var mt="mapsed-full-window",Y=$("#"+mt);Y.length||(Y=$("<div id='mapsed-full-window' class='mapsed-full-window'></div>"),Y.appendTo("body")),X=!0,ct()}return this}}(jQuery);